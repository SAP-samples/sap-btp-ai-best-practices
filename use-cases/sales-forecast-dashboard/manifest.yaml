---
applications:
  # Backend API Application
  - name: sales-forecast-dashboard-api
    path: api
    buildpack: python_buildpack
    command: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    memory: 1536M
    disk_quota: 4G
    instances: 1
    env:
      # CORS and API config
      ALLOWED_ORIGIN: https://sales-forecast-dashboard-ui.cfapps.eu10-004.hana.ondemand.com
      API_BASE_URL: https://sales-forecast-dashboard-api.cfapps.eu10-004.hana.ondemand.com
      APP_ENV: production
      API_KEY: ((api_key))
      # HANA credentials
      # hana_address: ((hana_address))
      # hana_port: "443"
      # hana_user: ((hana_user))
      # hana_password: ((hana_password))
      # hana_encrypt: "true"
      # HANA_SCHEMA: AICOE
      # # GenAI Hub (via AI Core service binding)
      # AICORE_SERVICE_KEY: ((aicore_service_key))
      # Agent configuration
      AGENT_PROVIDER: vertexai
      AGENT_MODEL: gemini-2.5-flash
      AGENT_TEMPERATURE: "0.2"
      # Session management
      MAX_SESSIONS: "100"
      SESSION_TTL_HOURS: "24"
      # Memory optimization for 1.5GB limit
      # Monte Carlo traffic estimation settings
      TRAFFIC_N_SIMULATIONS: "2000"
      TRAFFIC_BATCH_SIZE: "200"
      TRAFFIC_ESTIMATION_ENABLED: "true"
      # SHAP explainability settings
      SHAP_BATCH_SIZE: "500"
      SHAP_ENABLED: "true"
      COMPUTE_PER_HORIZON_SHAP: "false"

  # Frontend UI Application
  - name: sales-forecast-dashboard-ui
    path: ui
    buildpack: nodejs_buildpack
    command: npx vite preview --host 0.0.0.0 --port $PORT
    memory: 256M
    disk_quota: 512M
    instances: 1
    env:
      VITE_API_BASE_URL: https://sales-forecast-dashboard-api.cfapps.eu10-004.hana.ondemand.com
      VITE_APP_HOST: sales-forecast-dashboard-ui.cfapps.eu10-004.hana.ondemand.com
      VITE_API_KEY: ((api_key))
