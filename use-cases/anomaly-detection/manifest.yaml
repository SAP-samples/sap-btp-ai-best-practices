---
applications:
  # FastAPI backend
  - name: anomaly-api
    memory: 512M
    disk_quota: 2G
    instances: 1
    stack: cflinuxfs4
    path: backend
    buildpacks:
      - python_buildpack
    command: >
      cd app && uvicorn main:app --host 0.0.0.0 --port $PORT
    timeout: 300
    health-check-type: port
    health-check-timeout: 300
    routes:
      - route: anomaly-dashboard-api.cfapps.eu10-004.hana.ondemand.com
    env:
      APP_ENV: production
      PYTHONPATH: .
      PYTHONUNBUFFERED: 1
      ALLOWED_ORIGIN: https://anomaly-dashboard.cfapps.eu10-004.hana.ondemand.com
      API_BASE_URL: https://anomaly-dashboard-api.cfapps.eu10-004.hana.ondemand.com
      API_KEY: ((api_key))
  # UI5 frontend (static files)
  - name: anomaly-ui5
    memory: 64M
    disk_quota: 256M
    instances: 1
    stack: cflinuxfs4
    path: frontend/dist
    buildpacks:
      - staticfile_buildpack
    timeout: 60
    health-check-type: port
    routes:
      - route: anomaly-dashboard.cfapps.eu10-004.hana.ondemand.com
